<?xml version="1.0" encoding="utf-8" ?>
<odoo>

  <template
        id="portal_my_home_menu_weighbridge"
        name="Portal layout : weighbridge menu entries"
        inherit_id="portal.portal_breadcrumbs"
        priority="20"
    >
    <xpath expr="//ol[hasclass('o_portal_submenu')]" position="inside">
      <li
                t-if="page_name=='weighbridge' or scale"
                t-attf-class="breadcrumb-item #{'active' if not scale else ''}"
            >
        <a t-if="scale" t-attf-href="/my/weighbridge?{{ keep_query() }}">Weighbridge</a>
        <t t-else="">Weighbridge</t>
      </li>
      <li t-if="scale" class="breadcrumb-item active">
          <t t-out="scale.name" />
      </li>
    </xpath>
  </template>


  <template
        id="portal_my_home_weighbridge"
        name="Show Weighbridge Tickets"
        customize_show="True"
        inherit_id="portal.portal_my_home"
        priority="25"
    >
    <xpath expr="//div[hasclass('o_portal_docs')]" position="before">
      <t t-set="portal_vendor_category_enable" t-value="True" />
    </xpath>
    <div id="portal_vendor_category" position="inside">
      <t t-call="portal.portal_docs_entry">
        <t t-set="icon" t-value="'/wi_base_weighbridge/static/src/img/scale.svg'" />
        <t t-set="text">Follow your Weighbridge Tickets</t>
        <t t-set="title">Weighbridge Tickets</t>
        <t t-set="url" t-value="'/my/weighbridge'" />
        <t t-set="placeholder_count" t-value="'wb_scale_count'" />
      </t>
    </div>
  </template>

  <template id="portal_my_weighbridge" name="My Weighbridge Scales">
    <t t-call="portal.portal_layout">
      <t t-set="breadcrumbs_searchbar" t-value="True" />

      <t t-call="portal.portal_searchbar">
        <t t-set="title">Your Scales</t>
      </t>
      <div t-if="not scales" class="alert alert-warning" role="alert">
        There are currently no scales for your account.
      </div>
      <t t-if="scales" t-call="portal.portal_table">
        <thead>
          <tr class="active">
            <th>
              <span class="d-none d-md-inline">Scale#</span>
              <span class="d-block d-md-none">Ref.</span>
            </th>
            <th class="text-end">Delivery Number</th>
            <th class="text-end">Date</th>
            <th class="text-end">Quantity</th>
            <th class="text-end">Weight In</th>
            <th class="text-end">Weight Out</th>
            <th class="text-end">Net After QC</th>
          </tr>
        </thead>
        <t t-foreach="scales" t-as="scale">
          <tr>
            <td>
              <a t-att-href="scale.get_portal_url()">
                <t t-out="scale.name" />
              </a>
            </td>
            <td class="text-end">
              <span t-field="scale.delivery_number" />
            </td>
            <td class="text-end">
              <span t-field="scale.date" t-options="{'widget': 'date'}" />&amp;nbsp;
            </td>
            <td class="text-end">
              <span t-field="scale.quantity" />
            </td>
            <td class="text-end">
              <span t-field="scale.weight_in" />
            </td>
            <td class="text-end">
              <span t-field="scale.weight_out" />
            </td>
            <td class="text-end">
              <span t-field="scale.net_after_quality_control" />
            </td>
            <td class="text-center">
              <span
                                t-if="scale.state == 'posted'"
                                class="badge rounded-pill text-bg-success"
                            >
                <i
                                    class="fa fa-fw fa-check"
                                    role="img"
                                    aria-label="Post"
                                    title="Post"
                                />Post
              </span>
              <span
                                t-if="scale.state == 'draft'"
                                class="badge rounded-pill text-bg-info"
                            >
                <i
                                    class="fa fa-fw fa-pencil"
                                    role="img"
                                    aria-label="Draft"
                                    title="Draft"
                                />Draft
              </span>
              <span
                                t-if="scale.state == 'cancel'"
                                class="badge rounded-pill text-bg-danger"
                            >
                <i
                                    class="fa fa-fw fa-ban"
                                    role="img"
                                    aria-label="Cancel"
                                    title="Cancel"
                                />Cancel
              </span>
              <span
                                t-if="scale.state == 'locked'"
                                class="badge rounded-pill text-bg-success"
                            >
                <i
                                    class="fa fa-fw fa-key"
                                    role="img"
                                    aria-label="Locked"
                                    title="Locked"
                                />Locked
              </span>
              <span
                                t-if="scale.state == 'merged'"
                                class="badge rounded-pill text-bg-info"
                            >
                <i
                                    class="fa fa-fw fa-link"
                                    role="img"
                                    aria-label="Merged"
                                    title="Merged"
                                />Merged
              </span>
            </td>
          </tr>
        </t>
      </t>
    </t>
  </template>

  <template
        id="portal_my_weighbridge_scale"
        name="My Weighbridge Scale"
        inherit_id="portal.portal_sidebar"
        primary="True"
    >
    <xpath expr="//div[hasclass('o_portal_sidebar')]" position="inside">
      <t t-set="o_portal_fullwidth_alert">
        <t t-call="portal.portal_back_in_edit_mode">
          <t
                        t-set="backend_url"
                        t-value="'/web#model=%s&amp;id=%s&amp;action=%s&amp;view_type=form' % (scale._name, scale.id, scale.env.ref('wi_base_weighbridge.action_weighbridge_scale_view').id)"
                    />
        </t>
      </t>

      <div class="row o_portal_weighbridge_sidebar">
        <!-- Sidebar -->
        <t t-call="portal.portal_record_sidebar">
          <t t-set="classes" t-value="'col-lg-3 col-xl-4 d-print-none'" />

          <t t-set="title">
            <h2 t-field="scale.name" data-id="name" />
          </t>
          <t t-set="entries">
            <div class="d-flex flex-column gap-4">
              <div class="flex-grow-1 order-md-last order-lg-first">
                <div class="o_download_pdf btn-toolbar flex-sm-nowrap">
                  <div class="btn-group flex-grow-1 mb-1">
                        <div
                                            class="btn-group flex-grow-1 mr-1 mb-1"
                                            style="margin-right: 0.5em;"
                                        >
                            <a
                                                class="btn btn-secondary btn-block o_print_btn o_portal_weighbridge_print"
                                                t-att-href="scale.get_portal_url(report_type='pdf')"
                                                id="print_weighbridge_report"
                                                title="View Details"
                                                target="_blank"
                                            >
                                <i class="fa fa-print" /> View Details
                            </a>
                        </div>
                        <div
                                            class="btn-group flex-grow-1 mr-1 mb-1"
                                            style="margin-right: 0.5em;"
                                        >
                            <a
                                                class="btn btn-secondary btn-block o_download_btn"
                                                t-att-href="scale.get_portal_url(report_type='pdf', download=True)"
                                                title="Download"
                                            >
                                <i class="fa fa-download" /> Download
                            </a>
                        </div>
                  </div>
                </div>
              </div>

              <div t-if="scale.create_uid" class="flex-grow-1">
                <h6>
                    <small class="text-muted">
                      Representative
                    </small>
                </h6>
                <div class="o_portal_contact_details d-flex flex-column gap-2">
                    <div class="d-flex justify-content-start align-items-center gap-2">
                        <img
                                            class="o_avatar o_portal_contact_img rounded"
                                            t-att-src="image_data_uri(scale.create_uid.avatar_128)"
                                            alt="Contact"
                                        />
                        <div>
                            <h6 class="mb-0" t-out="scale.create_uid.name" />
                            <a
                                                href="#discussion"
                                                class="d-flex align-items-center gap-2 small fw-bold"
                                            >
                            Send message
                            </a>
                        </div>
                    </div>
                    <div
                                        t-field="scale.create_uid"
                                        t-options='{"widget": "contact", "fields": ["city", "phone"]}'
                                    />
                </div>
              </div>
            </div>
          </t>
        </t>

        <!-- Page content -->
        <div id="scale_content" class="o_portal_content col-12 col-lg-9 col-xl-8">
          <!-- status messages -->
          <div
                        t-if="scale.state == 'cancel'"
                        class="alert alert-danger alert-dismissable d-print-none"
                        role="alert"
                    >
            <button
                            type="button"
                            class="btn-close"
                            data-bs-dismiss="alert"
                            aria-label="close"
                        />
            <strong>This Ticket has been canceled.</strong>
          </div>

          <!-- main content -->
          <div class="o_portal_html_view shadow p-3">
            <div class="o_portal_html_loader text-center">
                <i class="fa fa-circle-o-notch fa-spin fa-2x fa-fw text-black-50" />
            </div>
            <iframe
                            id="weighbridge_ticket_html"
                            class="mt8 mb8"
                            width="100%"
                            height="100%"
                            frameborder="0"
                            scrolling="no"
                            t-att-src="scale.get_portal_url(report_type='html')"
                        />

          </div>
          <!-- chatter -->
          <hr />
          <div id="weighbridge_order_communication">
            <h3>Communication history</h3>
            <t t-call="portal.message_thread" />
          </div>
        </div>
        <!-- // #quote_content -->
      </div>
    </xpath>
  </template>
</odoo>
